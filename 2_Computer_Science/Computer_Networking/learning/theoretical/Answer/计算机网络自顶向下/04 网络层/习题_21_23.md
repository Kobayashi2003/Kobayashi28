#### P21 考虑在图 4-22 中建立的网络。假定 ISP 此时为路由器分配地址 24.34.112.235 以及家庭网络的网络地址是 192.168.1/24。
#### a. 在家庭网络中为所有接口分配地址
#### b. 假定每台主机具有两个进行中的 TCP 连接，所有都是对主机 128.119.40.86 的 80 端口的。在 NAT 转换表中提供 6 个对应表项。

  * a.
    
    |接口|IP地址|
    |:---:|:---:|
    |路由器接口| `192.168.1.1`|
    |第一台主机| `192.168.1.2`|
    |第二台主机| `192.168.1.3`|
    |第三台主机| `192.168.1.4`|
  
  * b.
    
    |NAT 转换表|WAN端|LAN端|
    |:---:|:--:|:---:|
    |A|`24.34.112.235, 1000`| `192.168.1.2, 4000` |
    |A|`24.34.112.235, 1001`| `192.168.1.2, 4001` |
    |B|`24.34.112.235, 1002`| `192.168.1.2, 4002` |
    |B|`24.34.112.235, 1003`| `192.168.1.2, 4003` |
    |C|`24.34.112.235, 1004`| `192.168.1.2, 4004` |
    |C|`24.34.112.235, 1005`| `192.168.1.2, 4005` |

#### P22 假设你有兴趣检测 NAT 后面的主机数量。你观察到在每个 IP 分组上 IP 层顺序地标出一个标示号。由一台主机生成的第一个 IP 分组的标示号是一个随机数，后继 IP 分组的标示号是顺序分配的。假设由 NAT 后面主机产生的所有 IP 分组都发往外部。
#### a. 基于这个观察，假定你能够俘获由 NAT 向外部发送的所有分组，你能概要给出一种简单的技术来检测 NAT 后面不同主机的数量吗？评估你的答案。
#### b. 如果标示号不是顺序分配而是随机分配的，这种技术还能正常工作吗？评估你的答案。

  * a.
    * 意思是每台主机进行 IP 分片时，为 IP 数据报选择的 2 字节标示是一个随机值，第一个报文的所有分片都是该随机值，第二个报文的所有分片是该随机值加 1，由于每台主机都是选一个随机的初始值，但随后的分组都是连续递增的，所以将这些切片划分为连续递增的多个簇，最后统计簇的数量，就是 NAT 后面主机的数量。
   
  * b.
    * 不能，因为无法统计连续递增的标示号的数量了。

#### P23 在这个习题中，我们将探讨 NAT 对 P2P 应用程序的影响。假定具有用户名 Arnold 的对等方通过查询发现，具有用户名 Bernard 的对等方有一个要下载的文件。同时假定 Bernard 和 Arnold 都位于 NAT 后面。尝试设计一种技术，使得 Arnold 与 Bernard 创建一条 TCP 连接，而不对 NAT 做应用特定的配置。如果你难以设计这样的技术，试讨论原因。

  * 如果不对 NAT 做应用特定的配置，那么直接 TCP 连接两个 NAT 后面的主机是无法做到的。因为你不知道每个 NAT 端口映射的规则。如果可以对 NAT 做应用特定的配置的话，那么只需要双方约定一个端口映射，那么就可以完成两个 NAT 后面的主机的 TCP 连接。