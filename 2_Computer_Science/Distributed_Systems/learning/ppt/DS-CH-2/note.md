# 分布式系统案例

- 分布式文件系统（HDFS、NFS、Ceph）
- 分布式数据库（MongoDB、Cassandra、ElasticSearch）
- 分布式处理框架（Hadoop、MPI、Spark、Storm）
- 分布式调度器（YARN、Mesos、Slurm）
- 分布式操作系统（Kubernetes、OpenStack）

# 软件体系结构样式

**基本思想**

“样式”包含以下几个方面：
- （可替换性）组件具有定义良好的接口；
- 组件之间互联的方式；
- 组件之间交换的数据；
- 组件以及连接器是如何协同配置的；

**连接器**

- 连接器提供了一种机制，在组件之间传递通信、使组件相互协调和协作。

**分类**

- 根据组件和连接器的使用，可以出现不同的配置，从而划分不同的体系结构，包括：分层体系结构；基于对象的体系结构；以数据为中心的体系结构；基于事件的体系结构。

# 软件体系结构风格

![软件体系风格-1](./img/软件体系结构风格-1.png)

![软件体系风格-2](./img/软件体系结构风格-2.png)

**Pub/Sub**（发布/订阅）是一种消息传递模型，其中消息发送者（发布者）将消息发布到一个或多个主题（topics）或频道（channels），而消息接收者（订阅者）订阅特定的主题或频道以接受消息。

在Pub/Sub模式中，发布者和订阅者不直接通信，而是通过一个中介（通常称为消息代理或消息中间件）进行通信。发布者将消息发送到消息代理，消息代理将消息存储在某个地方，并根据订阅者的订阅列表将消息推送给相应的订阅者。

Pub/Sub模式具有以下优点：

1. 异步：发布者和订阅者可以在不同的时间、不同的地点发送和接受消息，从而实现异步通信。
2. 解耦：发布者和订阅者不需要知道彼此的存在，只需要知道消息代理的存在，从而降低了耦合度。
3. 广播：发布者可以将消息发送给多个订阅者，从而实现广播效果。
4. 负载均衡：订阅者可以从多个消息代理中接受消息，从而实现负载均衡的效果。


# 系统体系结构

**系统体系结构（System Architecture）**：确定软件组件、这些组件的交互以及他们的部署位置就是软件体系结构的一个实例，称为系统体系结构。


- 集中式体系结构（master slave）
  - 整个系统包含一个控制中心，协同系统的运行；
- 非集中式组织结构（P2P）
  - 系统没有一个整体的控制中心，各个节点独立自主运行；
- 混合组织结构（点对点文件共享）
  - 系统中既包含集中式结构也包含非集中式结构；


# 客户端-服务器模型（Client-Server）

![CS模型-1](./img/CS模型-1.png)

![CS模型-2](./img/CS模型-2.png) 

![AJAX](./img/AJAX.png) 


# 应用分层

## 应用分层类别

![应用分层类别](./img/应用分层类别.png) 

## 分层通信协议

![分层通信协议](./img/分层通信协议.png) 

## 两节点通信

![两节点通信](./img/两节点通信.png)

## 传统的三层视图

- 用户接口层
  - 用户接口层包含系统与用户直接交互的单元；
- 应用处理层
  - 包含应用的主要函数，但是，不予具体的数据绑定；
- 数据层
  - 数据层管理应用使用的实际数据。

![因特网搜索引擎简化成三个不同的层](./img/因特网搜索引擎简化成三个不同的层.png) 

# 基于对象的体系结构风格

![基于对象的体系结构风格](./img/基于对象的体系结构风格.png)

# RESTful架构风格

![RESTful架构风格](./img/RESTful架构风格.png)

# 关于接口

![接口](./img/接口.png)

# 协同（Coordination）

![协同](./img/协同.png)

# 多层架构

![多层架构-1](./img/多层架构-1.png)

![多层架构-2](./img/多层架构-2.png)

# 非集中式体系结构

- **垂直分布**（Vertical Distribution）
  - 系统逻辑分层，不同层次分布在不同的的机器上；
- **水平分布**（Horizontal Distribution）
  - 客户或者服务器在物理上分成逻辑上相等的几个部分，每个部分相对独立，且分布在不同的机器上；
- 点对点系统（Peer-to-Peer System）
  - **水平分布**，构成点对点的系统的进程完全相同（即是客户端又是服务器、无中心化系统）；

## P2P系统的分类

P2P系统主要分布为以下几种类型：

- **结构化的P2P系统**
  - P2P系统中的节点按照特定的分布式数据结构组织；
  - 将节点组织在一个特定结构的覆盖网络中，如环形结构，让这些节点根据自己的ID提供相应的职能；
  - 语义无关的索引；
  - 数值与唯一的键值对应；（最佳实践：利用Hash函数）
  - P2P系统用于存储 (key,value) 对
- **无结构化的P2P系统**
  - 节点的邻居是随机选择的
- **混合型P2P系统**
  - 系统中的某些节点具有良好的组织形式；


## Chord结构  

![Chord结构-1](./img/Chord结构-1.png)

![Chord结构-2](./img/Chord结构-2.png)

## CAN（Content Addressable Network）内容可编址结构

![CAN结构](./img/CAN结构.png)

# 非结构的点对点系统

## 本质

- 每个节点维持一个动态随机的邻接表；
- 目标是构建一个随机图；
- 部分视图：从当前节点集合中随机选择出来c个“活”节点；
- 边`<u,v>`存在的概率为`p(<u,v>)`；
- 节点P周期性地从部分视图中选择节点Q，并且交换信息；

## 部分视图构造

![部分视图构造](./img/部分视图构造.png)

## P2P系统数据搜索方式

- **泛洪方式**

![泛洪方式](./img/泛洪方式.png)

- **随机游走**

![随机游走](./img/随机游走.png)

## 覆盖网络拓扑管理

- 核心思想（**两层方法**）：
  - 在最底层维护随机的部分视图；
  - 在较高层的部分视图上进行表项选择；

![覆盖网络拓扑管理](./img/覆盖网络拓扑管理.png)

## 超级对等节点

![超级对等节点](./img/超级对等节点.png)

- 核心思想：
  - 非结构化的点对点系统中，数据项的定位非常困难；
  - 打破点对点网络的对称性；
  - 设置代理程序；
- 超级对等节点：
  - 维护一个索引或充当一个代理程序的节点；
  - 在非结构化的P2P进行搜索时，索引服务器会提高性能；
  - 通过代理程序可以更加有效地决定在哪里放置数据；

# 混合架构

## 边界服务器

![边界服务器](./img/边界服务器.png)

## 协作分布式系统

![协作分布式系统](./img/协作分布式系统.png)

# 体系结构与中间件

- 问题
  - 分布式系统的透明性；
  - 体系结构非最优，需要中间件提供动态自适应能力；
  - 中间件的自适应能力（策略和机制分离）；
- **拦截器**（interceptors）
  - 拦截器是一种软件结构；
  - 拦截器应具有通用性；
  - 基于对象的分布式系统的中断；

## 中断器（代理）

![中断器](./img/中断器.png)

## 自适应中间件

![自适应中间件](./img/自适应中间件.png)

## 分布式系统的自我管理

- 问题
  - 在需要完成自适应功能时，系统架构和软件架构之间的界线逐渐模糊。
- 自主计算
  - 自我管理；
  - **自我恢复**；
  - **自我配置**；
  - **自我优化**；
  - ...

## 反馈控制模型

![反馈控制模型](./img/反馈控制模型.png)